---
title: 链接(一)
date: 2022-11-14 00:04:39
tags: csapp
categories: 操作系统
---
可执行文件的生成步骤<!--more-->
![](/img/hello.png)
可执行文件的生成过程如下图：
![](/img/步骤.png)
如图，可执行文件的生成需要经过预处理、编译、汇编和链接这4个过程。其中：
预处理的工作：
删除 #define 并展开宏定义
处理所有的条件预编译指令，如 "#if"，"#ifdef"，"#endif"等
插入头文件到 "#include" 处，可以递归方式进行处理
删除所有的注释
添加行号和文件名标识，以便编译时编译器产生调试用的行号信息
保留所有 #pragma 编译指令（编译器需要用）
命令示例如下：
gcc -E hello.c -o hello.i
经过预编译处理后，得到的是预处理文件（如，hello.i），它还是一个可读的文本文件，但不包含任何宏定义。

编译的工作
编译过程就是将预处理后得到的预处理文件（如hello.i）进行词法分析、语法分析、语义分析、优化后，生成汇编代码文件。
经过编译后，得到的汇编代码文件（如，hello.S）还是一个可读的文本文件。
命令示例如下：
```bash
gcc -S hello.i -o hello.s
gcc -S hello.c -o hello.s
```
汇编的工作
汇编器将编译得到的汇编代码文件转换成机器指令序列。
汇编的结果是一个可重定位目标文件（如，hello.o）其中包含的是不可读的二进制代码。
命令示例如下：
```bash
gcc -c hello.s -o hello.o
gcc -c hello.c -o hello.o
```